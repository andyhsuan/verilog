# SAFE 軟體最大化函數引擎設計報告

## 1. 設計概述
本報告詳細描述了 SAFE (Softmax Activation Function Engine) 的設計與實現，該模組是一種用於計算軟體最大化函數的硬體引擎，適用於深度學習應用。設計基於 Verilog 硬體描述語言，並透過 Python 模擬驗證其輸入輸出行為。設計遵循 8 位固定點輸入 (0 至 2.5) 與 12 位固定點輸出 (0 至 1) 的規格，並根據提供的時序圖進行時序控制。

## 2. 功能規格
- **輸入**:
  - `clk`: 時鐘信號。
  - `reset`: 重置信號。
  - `strobe`: 觸發信號。
  - `idxi[2:0]`: 3 位輸入索引 (0 至 5)。
  - `x[11:0]`: 12 個 12 位固定點輸入值，範圍 0 至 2.5。
- **輸出**:
  - `done`: 計算完成信號。
  - `valid`: 輸出有效信號。
  - `idxo[2:0]`: 3 位輸出索引。
  - `y[11:0]`: 12 個 12 位固定點輸出值，範圍 0 至 1。
- **時序**: 根據時序圖，計算分為多個時鐘週期，包括輸入捕捉、指數計算、總和計算及輸出階段。

## 3. 設計實現
### 3.1 Verilog 實現
- 使用狀態機控制時序，包含 IDLE、COMPUTE_EXP、SUM_EXP、COMPUTE_OUT 及 OUTPUT 狀態。
- 指數計算採用簡化近似方法，基於 8 位固定點輸入轉換為 12 位固定點輸出。
- 軟體最大化輸出通過正規化計算，確保總和為 1。

### 3.2 Python 模擬
- 模擬程式使用 asyncio 實現時序控制，兼容 Pyodide 環境。
- 輸入 `x` 模擬 12 個值 (0 至 2.4)，輸出 `y` 通過簡化 softmax 函數計算。
- 時序模擬匹配 Verilog 設計，包含觸發 `strobe` 及輸出驗證。

## 4. 測試與驗證
- **Testbench**: 使用 Iverilog 編譯 Verilog 程式，生成 VCD 文件進行波形分析。
- **模擬結果**: Python 模擬輸出顯示輸入 `x` 與輸出 `y` 的映射，驗證固定點運算正確性。
- **時序驗證**: 確保 `done` 與 `valid` 信號在適當時鐘週期內生效。

## 5. 結論
SAFE 模組成功實現了軟體最大化函數的硬體加速，符合規格要求。未來可優化指數計算精確度並擴展輸入範圍以提升性能。報告完成日期為 2025 年 7 月 2 日晚間 10:35 CST。
